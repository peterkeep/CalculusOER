<?xml version="1.0" encoding="UTF-8"?>

<section xml:id="sec-uSubstitution" xmlns:xi="http://www.w3.org/2001/XInclude">
    <title>Introduction to <m>u</m>-Substitution</title>
    <introduction>
        <p>
            We have spent some time thinking about integrals, both indefinite and definite integrals, and what they represent. Let's end this discussion of integration with some classifications of indefinite integrals.
        </p>
        <p>
            This classification is completely unserious, but maybe helpful. Let's say that we had to classify each of the following integrals as <kbd>Easy</kbd>, <kbd>Medium</kbd>, or <kbd>Hard</kbd>. Again, these are completely ambiguous and not at all defined, but I hope that we can see the spirit of what we're thinking of. Here are the three integrals that we want to classify:
        </p>
        <sidebyside>
            <p>
                <me>
                    \int x^5\;dx
                </me>
            </p>
            <p>
                <me>
                    \int \sec^2(x)\;dx
                </me>
                
            </p>
            <p>
                <me>
                    \int \frac{x^3}{1+x^2}\;dx
                </me>
            </p>
        </sidebyside>
        <p>
            Which one could have the <kbd>Easy</kbd>? What about a <kbd>Medium</kbd> difficulty integral? What makes this one a bit harder, but not so hard to be classified as <kbd>Hard</kbd>? Can you even solve the <kbd>Hard</kbd> right now?
        </p>
        <p>
            Let's think about a legitimately difficult integral, but one that we <em>can</em> actually think about.
        </p>
        <xi:include href="./activities/act-UndoChainRule.ptx" />
    </introduction>
    <subsection xml:id="subsec-UndoChainRule">
        <title>Undoing the Chain Rule</title>
        <p>
            Let's try to formalize this process of "undoing the Chain Rule" that we noticed in <xref ref="act-UndoChainRule"/>. It might be helpful to, first, think about the Chain Rule and how the differentiation process works. Let's look at the differentiating <m>\sin(x^7)</m> using the Chain Rule.
        </p>
        <p>
            The first thing we should do when finding <m>\ddx{\sin(x^7)}</m> is recognize and identify the composition. We might call <m>x^7</m> the "inside" function, or re-label it as <m>u</m>. Then we know that the Chain Rule will tell us to differentiate the "outside" function with regard to the "inside" function (or <m>u</m> if we re-label things) and then multiply by the derivative of the inside function (or <m>\frac{du}{dx}</m>).
            <md>
                <mrow>\ddx{\sin(\underbrace{x^7}_{u})} \amp =\ddx{\sin(u)}</mrow>
                <mrow> \amp = \frac{d}{du}\left(\sin(u)\right)\left(\frac{du}{dx}\right)</mrow>
                <mrow> \amp = \cos(u)\ddx{x^7}</mrow>
                <mrow> \amp = \cos(x^7)7x^6</mrow>
            </md>
            From here, we might re-write things to make it look nicer (coefficients look weird when they're not in the front ðŸ˜­) and write:
            <me>
                \ddx{\sin(x^7)}= 7x^6\cos(x^7)
            </me>
        </p>
        <p>
            When we work through this process backwards, we'll need to identify the "inside" function, but also find the derivative of that "inside" function, <m>\frac{du}{dx}</m>. This derivative gets introduced in the Chain Rule, and so it will have to be picked out when we undo the Chain Rule.
        </p>
        <p>
            Let's build this process and go through the integral <m>\displaystyle \int 7x^6\cos(x^7)\;dx</m> from <xref ref="act-UndoChainRule"/>.
        </p>
        <assemblage xml:id="strat-uSubstitution">
            <title>Process for <m>u</m>-Substitution</title>
            <p>
                <ol>
                    <li>
                        <p>
                            Identify an "inside" function and/or a "function-derivative pair." We'll label the "inside" function, or the "function" part of the "function-derivative pair," as <m>u</m>.
                        </p>
                        <p>
                            <em>Example:</em> In our integral <m>\displaystyle\int 7x^6\cos(x^7)\;dx</m> we can see the "inside" function is <m>x^7</m>, and also we have <m>x^7</m> and <m>7x^6</m> as the function-derivative pair. Let <m>u=x^7</m>.
                        </p>
                    </li>
                    <li>
                        <p>
                            Define the substitution for the differential, <m>du=u'\;dx</m>. We can think about this as a result from knowing that <m>\frac{du}{dx}=u'</m>, or by thinking that a small change in <m>u</m> corresponds with <m>u'</m> multiplied by a small change in <m>dx</m>. 
                        </p>
                        <p>
                            <em>Example:</em> In our integral <m>\displaystyle\int 7x^6\cos(x^7)\;dx</m>, we labeled <m>u=x^7</m>. This means that <m>du=7x^6\;dx</m>, since this is the derivative of <m>x^7</m>.
                        </p>
                    </li>
                    <li>
                        <p>
                            Substitute! Re-write the integral, replacing the parts that you've labeled as <m>u</m> and <m>du</m>.
                        </p>
                        <p>
                            <em>Example:</em> We can re-write our integral to make this a bit easier to see:
                            <md>
                                <mrow>\int 7x^6\cos(x)\;dx \amp = \int \cos(\underbrace{x^7}_{u})\underbrace{7x^6\;dx}_{du}</mrow>
                                <mrow> \amp = \int \cos(u)\;du</mrow>
                            </md>
                        </p>
                    </li>
                    <li>
                        <p>
                            Antidifferentiate! We should have an integral that is "written in terms of <m>u</m>," and so we can antidifferentiate the function as if <m>u</m> was our input variable. Notice that what we've done with our substitution is to undo the "multiply by the derivative of the inside function" step of the Chain Rule. Now we can antidifferentiate the "outside" function!
                        </p>
                        <p>
                            <em>Example:</em> <m>\displaystyle\int\cos(u)\;du = \sin(u)+C</m>
                        </p>
                    </li>
                    <li>
                        <p>
                            Substitute "back" to have our antiderivative family written in terms of our original input variable, <m>x</m> in this case. We'll replace <m>u</m> with whatever we had defined our substitution to be in step 1.
                        </p>
                        <p>
                            <em>Example:</em> We defined <m>u=x^7</m>, so:
                            <me>
                                \sin(u)+C = \sin(x^7)+C
                            </me>
                        </p>
                    </li>
                </ol>
            </p>
        </assemblage>
        <p>
            Let's practice this with some more examples.
        </p>
        <xi:include href="./activities/act-uSubPicking.ptx" />
        <figure xml:id="fig-uSub">
            <caption>General idea of how a variable substitution in an integral works.</caption>
            <image width="80%">
                <shortdescription></shortdescription>
                <latex-image>
                    \begin{tikzpicture}
                        \draw (0,0) -- (0,5);
                        \draw (0,5) -- (3,5);
                        \draw (3,5) -- (3,0);
                        \draw (3,0) -- (0,0);
                        \node at (1.5, 4) [above] {$\displaystyle\int f(x)\;dx$};
                        \node at (1.5, 1) [below] {$F(x)+C$};
                        \draw[-latex, line width=1.5pt] (1.5, 4) -- (1.5, 1);
                        \node at (1.5, 5.2) [above] {\Large $x$ Context};

                        \draw[DCgreen] (5,0) -- (5,5);
                        \draw[DCgreen] (5,5) -- (8,5);
                        \draw[DCgreen] (8,5) -- (8,0);
                        \draw[DCgreen] (8,0) -- (5,0);
                        \node[DCgreen] at (6.5, 4) [above] {$\displaystyle\int g(u)\;du$};
                        \node[DCgreen] at (6.5, 1) [below] {$G(u)+C$};
                        \draw[-latex, line width = 1.5pt][DCgreen] (6.5, 4) -- (6.5, 1);
                        \node[DCgreen] at (6.5, 5.2) [above] {\Large $u$ Context};

                        \draw[-latex, line width = 1.2pt][DCblue] (2.5,4.5) .. controls (3.2,5) and (4.8,5) .. (5.5,4.5);
                        \node[DCblue] at (4,5) [above] {$u = \leadsto ...$};
                        \node[DCblue] at (4,4.8) [below] {$du = u'\;dx$};

                        \draw[-latex, line width = 1.2pt][DCblue] (5.5,0.7) .. controls (4.8, 0.2) and (3.2,0.2) .. (2.5,0.7);
                        \node[DCblue] at (4,0.4) [above] {$u = \leadsto ...$};
                    \end{tikzpicture}
                </latex-image>
            </image>
        </figure>
    </subsection>

    <subsection xml:id="subsec-uSubDefiniteIntegrals">
        <title>Substitution for Definite Integrals</title>
        <p>
            
        </p>
         <interactive platform="doenetml" width="90%" aspect="1:1.5">
        <slate surface="doenetml">
            <xi:include parse="text" href="./doenet/uSubDefinite.xml"/>
        </slate>
    </interactive>
    </subsection>
    
    <subsection xml:id="subsec-MoreToTranslate">
        <title>More to Translate</title>
        <example>
            <introduction>
                <p>
                    Integrate the following, making sure to translate the whole integrand function to be written in terms of <m>u</m>.
                </p>
            </introduction>
            <task xml:id="ex-uSubTurn">
                <statement>
                    <p>
                        <m>\displaystyle\int \left( \frac{x^3}{\sqrt{x^2+1}} \right)\;dx</m>
                    </p>
                </statement>
                <hint>
                    <p>
                        We can write <m>x^3</m> as <m>x^2\cdot x</m>, or if you <em>really</em> want to, we can write it as <m>\frac{1}{2}x^2\cdot(2x)</m>
                    </p>
                </hint>
                <solution>
                    <p>
                        <md>
                            <mrow>\int \left(\frac{x^3}{\sqrt{x^2+1}}\right)\;dx \amp u = x^2+1</mrow>
                            <mrow> \amp du = 2x\;dx</mrow>
                            <mrow> \int \left(\frac{x^3}{\sqrt{x^2+1}}\right)\;dx\amp = \frac{1}{2}\int \left(\frac{x^2\cdot(2x)}{\sqrt{x^2+1}}\right)\;dx</mrow>
                            <mrow> \amp = \frac{1}{2}\int \frac{(u-1)}{\sqrt{u}}\;du \amp u=x^2+1 \leftrightarrow x^2=u-1</mrow>
                            <mrow> \amp = \frac{1}{2}\int \frac{u}{\sqrt{u}} - \frac{1}{\sqrt{u}}\;du</mrow>
                            <mrow> \amp = \frac{1}{2}\int u^{1/2} - u^{-1/2}\;du</mrow>
                            <mrow> \amp = \frac{1}{2}\left(\frac{2u^{3/2}}{3} - 2u^{1/2}\right) + C</mrow>
                            <mrow> \amp = \frac{(x^2+1)^{3/2}}{3} - \sqrt{x^2+1}+C</mrow>
                        </md>
                    </p>
                </solution>
            </task>
        </example>
    </subsection>
</section>